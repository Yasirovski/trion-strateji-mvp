<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Trion Strateji</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- AdSense Başlatma -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5776496009950122" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="styles.css">

  <!-- Google Charts Gauge -->
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script>
    google.charts.load('current',{packages:['gauge']});
  </script>
  <style>
    /* 2× genişlik için %200 */
    .sidebar, .main { width:200%; }
  </style>
</head>
<body>

<header>…</header>

<div class="container">
  <!-- Watchlist -->
  <aside class="sidebar">
    <div id="watchlist"></div>
  </aside>

  <!-- Chart + Gauge -->
  <section class="main">
    <div id="tv-chart"></div>
    <div id="gauge-container">
      <div id="gauge-chart" style="width:400px; height:240px; margin:auto"></div>
    </div>
  </section>

  <!-- Reklam & Haber -->
  <aside class="news">…</aside>
</div>

<footer>…</footer>

<script>
  const config = {
    BIST: {
      wl: [ /* BIST30 sembolleri */ ],
      chartSymbol: "BIST:XU100",
      gaugeURL: "./.netlify/functions/get-greed-bist"
    },
    USA: {
      wl: [ /* NASDAQ TOP10 */ ],
      chartSymbol: "NASDAQ:NDX",
      gaugeURL: "./.netlify/functions/get-greed-usa"
    },
    CMD: {
      wl: [ /* emtialar */ ],
      chartSymbol: "OANDA:XAUUSD",
      gaugeURL: "./.netlify/functions/get-greed-cmd"
    }
  };

  function loadWatchlist(market){
    const c = document.getElementById('watchlist');
    c.innerHTML = '';
    const s = document.createElement('script');
    s.src = "https://s3.tradingview.com/external-embedding/embed-widget-symbol-list.js";
    s.async = true;
    s.innerHTML = JSON.stringify({
      symbols: config[market].wl,
      showSymbolLogo: true, colorTheme: "light", locale: "tr"
    });
    c.appendChild(s);
  }

  function loadChart(market){
    const c = document.getElementById('tv-chart');
    c.innerHTML = '';
    const s = document.createElement('script');
    s.src = "https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js";
    s.async = true;
    s.innerHTML = JSON.stringify({
      symbol: config[market].chartSymbol,
      interval: "D", timezone: "Europe/Istanbul",
      theme: "light", style:"1", locale:"tr",
      container_id:"tv-chart"
    });
    c.appendChild(s);
  }

  function drawGauge(value){
    const data = google.visualization.arrayToDataTable([['Label','Value'],['',value]]);
    const options = {
      width:400, height:240,
      redFrom:0, redTo:25,
      yellowFrom:25, yellowTo:75,
      greenFrom:75, greenTo:100,
      minorTicks:5
    };
    const chart = new google.visualization.Gauge(document.getElementById('gauge-chart'));
    chart.draw(data, options);
  }

  function loadGauge(market){
    fetch(config[market].gaugeURL)
      .then(r=>r.json()).then(d=>{
        drawGauge(Math.round(d.value));
      }).catch(e=>{
        drawGauge(0);
        console.error(e);
      });
  }

  function switchMarket(m){
    loadWatchlist(m);
    loadChart(m);
    loadGauge(m);
  }

  // Başlangıç
  google.charts.setOnLoadCallback(() => switchMarket('BIST'));
</script>

</body>
</html>
