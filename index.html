<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Trion Strateji</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Google AdSense Başlatma Kodu -->
  <script async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5776496009950122"
    crossorigin="anonymous"></script>

  <!-- (Opsiyonel) Google Site Verification Meta Etiketi -->
  <!-- <meta name="google-site-verification" content="DOĞRULAMA_KODUNUZ" /> -->

  <!-- Harici Stil Dosyası -->
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<header>
  <h1>Trion Strateji</h1>
  <nav>
    <button onclick="switchMarket('BIST')">Borsa İstanbul</button>
    <button onclick="switchMarket('USA')">Amerika B.</button>
    <button onclick="switchMarket('CMD')">Emtialar</button>
  </nav>
</header>

<div class="container">
  <!-- Sol Sütun: Watchlist -->
  <aside class="sidebar">
    <div id="watchlist"></div>
  </aside>

  <!-- Orta Bölüm: Grafik ve Gauge -->
  <section class="main">
    <div id="chart"></div>
    <div id="gauge-container">
      <div id="gauge-value">--</div>
      <progress id="gauge" max="100" value="0"></progress>
    </div>
  </section>

  <!-- Sağ Sütun: Reklam & Haber -->
  <aside class="news">
    <!-- AdSense Reklam Birimi -->
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-5776496009950122"
         data-ad-slot="5878236921"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>

    <!-- RSS Haber Akışı -->
    <div id="rss-feed">
      <h3>Finans Haberleri</h3>
      <ul id="news-list"></ul>
    </div>
  </aside>
</div>

<footer>
  <a href="about.html">Hakkında</a> |
  <a href="contact.html">İletişim</a>
</footer>

<script>
  // Market konfigürasyonu
  const config = {
    BIST: { wl:'BIST30', chart:'XU100', gaugeURL:'/.netlify/functions/get-greed-bist' },
    USA : { wl:'NASDAQ_TOP10', chart:'SPX',  gaugeURL:'/.netlify/functions/get-greed-usa' },
    CMD : { wl:'CMD_LIST',    chart:'XAUUSD',gaugeURL:'/.netlify/functions/get-greed-cmd' }
  };

  function loadWatchlist(market) {
    document.getElementById('watchlist').innerHTML =
      `<iframe src="https://s.tradingview.com/embed-widget/symbol-list/?symbols=${config[market].wl}"></iframe>`;
  }

  function loadChart(market) {
    document.getElementById('chart').innerHTML =
      `<iframe src="https://s.tradingview.com/embed-widget/chart/?symbol=${config[market].chart}"></iframe>`;
  }

  function loadGauge(market) {
    fetch(config[market].gaugeURL)
      .then(res => res.json())
      .then(data => {
        const v = Math.round(data.value);
        document.getElementById('gauge-value').textContent = v;
        document.getElementById('gauge').value = v;
      })
      .catch(err => {
        document.getElementById('gauge-value').textContent = 'Err';
        console.error(err);
      });
  }

  (function loadRSS() {
    const RSS_URL = 'https://rss.investing.com/top-news.rss';
    const API = 'https://api.rss2json.com/v1/api.json?rss_url=' + encodeURIComponent(RSS_URL);
    fetch(API)
      .then(res => res.json())
      .then(data => {
        const ul = document.getElementById('news-list');
        data.items.slice(0,5).forEach(item => {
          const li = document.createElement('li');
          li.innerHTML = `<a href="${item.link}" target="_blank">${item.title}</a>`;
          ul.appendChild(li);
        });
      })
      .catch(console.error);
  })();

  function switchMarket(market) {
    loadWatchlist(market);
    loadChart(market);
    loadGauge(market);
  }

  // İlk açılışta BIST
  switchMarket('BIST');
</script>

</body>
</html>
