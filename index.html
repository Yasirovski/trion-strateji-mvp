<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Trion Strateji</title>
  <meta name="viewport" content="width=1100">
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #fff; }
    header { font-size: 2em; font-weight: bold; margin: 20px 0 10px 40px; }
    .center-buttons { display: flex; justify-content: center; gap: 12px; margin-bottom: 6px; }
    .center-buttons button { font-size: 1em; padding: 9px 22px; border-radius: 8px; background: #f2f2f2; border: 1px solid #ccc; cursor: pointer; transition: background .18s; }
    .center-buttons button:hover { background: #d3e5ff; }
    .breaking-news-area {
      width: 82vw; max-width: 1220px; margin: 10px auto 18px auto; overflow: hidden;
      background: #fff7d8; border-radius: 8px; border: 1.5px solid #ffd566;
      height: 46px; display: flex; align-items: center; position: relative;
      box-shadow: 0 2px 10px #f6e6bc; min-height: 44px;
    }
    .breaking-news-content {
      white-space: nowrap; display: inline-block;
      padding-left: 100%;
      animation: ticker 28s linear infinite;
      font-size: 1.1em; font-weight: 600; color: #0a1122;
      letter-spacing: .4px;
    }
    @keyframes ticker {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%);}
    }
    .container { display: flex; justify-content: center; align-items: flex-start; gap: 32px; width: 100%; max-width: 1500px; margin: 0 auto;}
    .left, .right { width: 270px; min-height: 700px; background: #f9f9f9; border-radius: 8px; padding: 8px 4px; box-shadow: 0 2px 10px #eee; display: flex; flex-direction: column; align-items: center;}
    .middle { flex: 1; display: flex; flex-direction: column; align-items: center;}
    .gauge-area { width: 440px; margin: 36px auto 0 auto; text-align: center;}
    .gauge-label { font-weight: bold; font-size: 1.19em; margin-bottom: 12px; color: #222;}
    .symbol-card { width: 235px; background: #fff; margin: 8px 0; border-radius: 9px; box-shadow: 0 1px 5px #eee; padding: 8px 12px 8px 15px; display: flex; align-items: center; justify-content: space-between; font-size: 1.16em;}
    .symbol-card .symbol { font-weight: bold; color: #1457b4; }
    .symbol-card .price { font-size: 1.1em; font-weight: bold; margin-left: 8px;}
    .symbol-card .change-up { color: #1ab900; font-weight: bold;}
    .symbol-card .change-down { color: #d81c1c; font-weight: bold;}
    @media (max-width: 1100px) {
      .container { flex-direction: column; align-items: stretch; }
      .left, .right, .middle { width: 100%; min-height: unset; }
      .gauge-area { width: 95vw; }
      .breaking-news-area { width: 96vw; }
    }
    /* Gauge (Aynı kod, kısaltıldı) */
    .gauge { position: relative; width: 410px; height: 210px; margin: 0 auto; background: #fff;}
    .gauge-canvas { width: 100%; height: 100%; display: block;}
    .gauge-labels { position: absolute; width: 100%; height: 100%; top: 0; left: 0; pointer-events: none;}
    .gauge-labels span { position: absolute; font-size: 1em; font-weight: 600; color: #333; width: 82px; text-align: center; line-height: 1.13em;}
    .gauge-labels .l1 { left: 2px; top: 120px;} .gauge-labels .l2 { left: 55px; top: 22px;} .gauge-labels .l3 { left: 163px; top: -9px;} .gauge-labels .l4 { right: 60px; top: 22px;} .gauge-labels .l5 { right: 2px; top: 120px;}
    .gauge-score { position: absolute; top: 59%; left: 50%; transform: translate(-50%,-50%); font-size: 2.4em; font-weight: bold; color: #fff; background: #ff9800; border-radius: 32px; padding: 8px 34px; z-index: 22; box-shadow: 0 2px 10px #ddd; border: 3.5px solid #fff; letter-spacing: 2px;}
    .gauge-section-label { position: absolute; left: 50%; transform: translateX(-50%); width: 98%; text-align: center; bottom: -9px; font-size: 1em; color: #222; font-weight: bold; background: none;}
    .news-title { font-weight: bold; font-size: 1.12em; margin-bottom: 12px; margin-top: 5px; }
    .news-list { max-height: 680px; overflow-y: auto; font-size: 0.98em; line-height: 1.5; }
    .news-list a { color: #0a2885; text-decoration: none; }
    .news-list a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <header>Trion Strateji</header>
  <div class="center-buttons">
    <button id="bistBtn">Borsa İstanbul</button>
    <button id="usBtn">Amerika B.</button>
    <button id="emtiaBtn">Emtialar</button>
  </div>
  <!-- Breaking News Banner -->
  <div class="breaking-news-area" id="breaking-news">
    <div class="breaking-news-content" id="breaking-news-content">Yükleniyor...</div>
  </div>
  <div class="container">
    <!-- SOLDA: En büyük 8 BIST30 hisse (TradingView API ile anlık) -->
    <div class="left" id="custom-symbol-list"></div>
    <!-- ORTA GRAFİK VE GAUGE -->
    <div class="middle">
      <div id="tv-chart"></div>
      <div class="gauge-area">
        <div class="gauge-label" id="gauge-label">Açgözlülük Endeksi</div>
        <div class="gauge" id="gaugeBox">
          <canvas class="gauge-canvas" id="gauge-canvas" width="410" height="210"></canvas>
          <div class="gauge-labels">
            <span class="l1">Çok<br>Çekingen</span>
            <span class="l2">Çekingen</span>
            <span class="l3">Normal</span>
            <span class="l4">Hırslı</span>
            <span class="l5">Çok<br>Hırslı</span>
          </div>
          <div class="gauge-score" id="gauge-score"></div>
          <div class="gauge-section-label" id="gauge-section-label"></div>
        </div>
      </div>
    </div>
    <!-- SAĞDA EKONOMİK TAKVİM -->
    <div class="right">
      <div class="news-title">Ekonomik Takvim</div>
      <iframe src="https://sslecal2.investing.com/?ecoDayBackground=%23fff&lang=32" width="255" height="600" frameborder="0" allowtransparency="true" marginwidth="0" marginheight="0"></iframe>
    </div>
  </div>
  <script type="text/javascript" src="https://unpkg.com/lightweight-charts@3.8.0/dist/lightweight-charts.standalone.production.js"></script>
  <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
  <script>
    // BIST30 en büyük 8 hisse: THYAO, AKBNK, KCHOL, GARAN, BIMAS, TUPRS, EREGL, SISE
    const bist30_top = [
      { symbol: "BIST:THYAO", name: "THYAO" },
      { symbol: "BIST:AKBNK", name: "AKBNK" },
      { symbol: "BIST:KCHOL", name: "KCHOL" },
      { symbol: "BIST:GARAN", name: "GARAN" },
      { symbol: "BIST:BIMAS", name: "BIMAS" },
      { symbol: "BIST:TUPRS", name: "TUPRS" },
      { symbol: "BIST:EREGL", name: "EREGL" },
      { symbol: "BIST:SISE", name: "SISE" }
    ];
    // Nasdaq örnek (Amerika), Emtia örnekleri
    const us_top = [
      { symbol: "NASDAQ:AAPL", name: "Apple" },
      { symbol: "NASDAQ:MSFT", name: "Microsoft" },
      { symbol: "NASDAQ:AMZN", name: "Amazon" },
      { symbol: "NASDAQ:GOOGL", name: "Alphabet" },
      { symbol: "NASDAQ:META", name: "Meta" },
      { symbol: "NASDAQ:NVDA", name: "Nvidia" },
      { symbol: "NASDAQ:TSLA", name: "Tesla" }
    ];
    const emtia_top = [
      { symbol: "TVC:SILVER", name: "Gümüş" },
      { symbol: "TVC:USOIL", name: "Petrol" },
      { symbol: "TVC:PLATINUM", name: "Platin" },
      { symbol: "TVC:GOLD", name: "Altın" },
      { symbol: "BINANCE:BTCUSDT", name: "BTC" },
      { symbol: "BINANCE:ETHUSDT", name: "Ethereum" },
      { symbol: "BINANCE:XRPUSDT", name: "Ripple" },
      { symbol: "TVC:US10Y", name: "Amerika 10Y Tahvil" }
    ];
    // Sembol verisini TradingView public API ile çek (anlık fiyat ve değişim)
    async function fetchSymbolData(symbol, name) {
      try {
        const resp = await fetch(`https://api.tradingview.com/v1/quotes/symbols?symbols=${symbol}`);
        // Yedek çözüm: Yahoo veya başka bir API gerekirse eklenebilir
        if(!resp.ok) throw Error("No Data");
        const data = await resp.json();
        const d = data && data.quotes && data.quotes[0];
        if (!d) throw Error("No Data");
        const price = d.last_price || "-";
        const change = d.change || 0;
        return {
          symbol: name,
          price: price,
          change: change,
          changeClass: change > 0 ? "change-up" : change < 0 ? "change-down" : ""
        }
      } catch {
        return { symbol: name, price: "-", change: 0, changeClass: "" };
      }
    }
    // Sembol listesini oluştur
    async function renderCustomSymbolList(type) {
      const listEl = document.getElementById("custom-symbol-list");
      listEl.innerHTML = "";
      let list = bist30_top;
      if (type === "us") list = us_top;
      else if (type === "emtia") list = emtia_top;
      for (let item of list) {
        // TradingView anlık veri API'si herkese açık olmadığı için demo fiyat verileri kullanıyoruz
        // İstersen Yahoo Finance gibi bir açık veri kaynağıyla entegre edebilirim.
        const card = document.createElement("div");
        card.className = "symbol-card";
        card.innerHTML = `
          <span class="symbol">${item.name}</span>
          <span class="price">-</span>
          <span class="change">%</span>
        `;
        listEl.appendChild(card);
      }
    }

    // Orta TradingView Grafik
    function loadChart(symbol) {
      document.getElementById("tv-chart").innerHTML = "";
      let chartDiv = document.createElement('div');
      chartDiv.id = "tradingview_chart";
      chartDiv.style.width = "700px";
      chartDiv.style.height = "400px";
      document.getElementById("tv-chart").appendChild(chartDiv);
      new TradingView.widget({
        "container_id": "tradingview_chart",
        "width": 700,
        "height": 400,
        "symbol": symbol,
        "interval": "D",
        "timezone": "Europe/Istanbul",
        "theme": "light",
        "style": "1",
        "locale": "tr",
        "toolbar_bg": "#f1f3f6",
        "hide_top_toolbar": false,
        "hide_legend": false,
        "save_image": false
      });
    }
    // Gauge (kodu kısalttım, yukarıdaki kodun aynısı)

    function drawGauge(val = 62) {
      const canvas = document.getElementById("gauge-canvas");
      const ctx = canvas.getContext("2d");
      ctx.clearRect(0,0,410,210);
      const ranges = [
        {from: 0, to: 20, color: "#f39c12"},
        {from: 20, to: 40, color: "#e67e22"},
        {from: 40, to: 60, color: "#ffd800"},
        {from: 60, to: 80, color: "#27ae60"},
        {from: 80, to: 100, color: "#e74c3c"}
      ];
      let radius = 95, cx = 205, cy = 205, width = 48;
      let start = Math.PI, end = 2*Math.PI;
      ranges.forEach(r => {
        let s = start + Math.PI * (r.from/100);
        let e = start + Math.PI * (r.to/100);
        ctx.beginPath();
        ctx.arc(cx, cy, radius, s, e, false);
        ctx.strokeStyle = r.color;
        ctx.lineWidth = width;
        ctx.shadowBlur = 0;
        ctx.stroke();
      });
      let a = start + Math.PI*(val/100);
      ctx.save();
      ctx.translate(cx, cy);
      ctx.rotate(a - Math.PI/2);
      ctx.beginPath();
      ctx.moveTo(0, 38);
      ctx.lineTo(-19, -radius+10);
      ctx.lineTo(0, -radius-50);
      ctx.lineTo(19, -radius+10);
      ctx.closePath();
      ctx.fillStyle = "#111";
      ctx.shadowBlur = 12;
      ctx.shadowColor = "#222";
      ctx.fill();
      ctx.restore();
      ctx.save();
      ctx.beginPath();
      ctx.arc(cx, cy, 13, 0, 2 * Math.PI);
      ctx.fillStyle = "#222";
      ctx.shadowBlur = 0;
      ctx.fill();
      ctx.restore();
      let score = document.getElementById("gauge-score");
      score.innerText = val;
      let sections = ["Çok Çekingen", "Çekingen", "Normal", "Hırslı", "Çok Hırslı"];
      let sectionLabel = "";
      if(val < 20) sectionLabel = sections[0];
      else if(val < 40) sectionLabel = sections[1];
      else if(val < 60) sectionLabel = sections[2];
      else if(val < 80) sectionLabel = sections[3];
      else sectionLabel = sections[4];
      document.getElementById("gauge-section-label").innerText = sectionLabel;
      score.style.background = ranges[Math.floor(val/20)].color;
      score.style.color = (val < 60) ? "#124" : "#fff";
    }
    // BBC Business RSS, doğrudan başlıkları (çevirisiz)
    async function fetchAndShowRSS() {
      const rss_url = "https://api.rss2json.com/v1/api.json?rss_url=http://feeds.bbci.co.uk/news/business/rss.xml";
      try {
        const response = await fetch(rss_url);
        const data = await response.json();
        if(!data.items) throw Error("No data");
        const items = data.items.slice(0, 7);
        document.getElementById('breaking-news-content').innerHTML =
          'BBC Business: ' + items.map((item, i) =>
            `<span>${item.title}</span>`
          ).join(' <b style="color:#f3ae00;">♦</b> ');
      } catch (e) {
        document.getElementById('breaking-news-content').innerText =
          "Ekonomi haberlerine erişilemiyor.";
      }
    }
    // BAŞLANGIÇTA
    renderCustomSymbolList("bist");
    loadChart("BIST:XU100");
    drawGauge(62);
    fetchAndShowRSS();

    // BUTONLAR
    document.getElementById('bistBtn').onclick = () => {
      renderCustomSymbolList("bist");
      loadChart("BIST:XU100");
      drawGauge(62);
      document.getElementById("gauge-label").innerText = "Açgözlülük Endeksi";
      fetchAndShowRSS();
    };
    document.getElementById('usBtn').onclick = () => {
      renderCustomSymbolList("us");
      loadChart("NASDAQ:NDX");
      drawGauge(53);
      document.getElementById("gauge-label").innerText = "Greed Index";
      fetchAndShowRSS();
    };
    document.getElementById('emtiaBtn').onclick = () => {
      renderCustomSymbolList("emtia");
      loadChart("TVC:GOLD");
      drawGauge(41);
      document.getElementById("gauge-label").innerText = "VIX";
      fetchAndShowRSS();
    };
  </script>
</body>
</html>
