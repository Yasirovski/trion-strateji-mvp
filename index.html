<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Trion Strateji</title>
  <meta name="viewport" content="width=1100">
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #fff; }
    header { font-size: 2em; font-weight: bold; margin: 20px 0 10px 40px; }
    .center-buttons {
      display: flex; justify-content: center; gap: 12px; margin-bottom: 16px;
    }
    .center-buttons button {
      font-size: 1em; padding: 9px 22px; border-radius: 8px;
      background: #f2f2f2; border: 1px solid #ccc; cursor: pointer;
      transition: background .18s;
    }
    .center-buttons button:hover { background: #d3e5ff; }
    .container {
      display: flex; justify-content: center; align-items: flex-start; gap: 32px;
      width: 100%; max-width: 1500px; margin: 0 auto;
    }
    .left, .right {
      width: 250px; min-height: 700px; background: #f9f9f9;
      border-radius: 8px; padding: 16px 10px; box-shadow: 0 2px 10px #eee;
    }
    .middle {
      flex: 1; display: flex; flex-direction: column; align-items: center;
    }
    .gauge-area {
      width: 440px; margin: 36px auto 0 auto; text-align: center;
    }
    .gauge-label {
      font-weight: bold;
      font-size: 1.19em;
      margin-bottom: 12px;
      color: #222;
    }
    .news-title { font-weight: bold; font-size: 1.12em; margin-bottom: 12px; margin-top: 5px; }
    .news-list { max-height: 680px; overflow-y: auto; font-size: 0.98em; line-height: 1.5; }
    .news-list a { color: #0a2885; text-decoration: none; }
    .news-list a:hover { text-decoration: underline; }
    .stock-list {
      list-style: none;
      padding: 0;
      margin: 0;
      width: 98%;
    }
    .stock-list li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 10px 8px 13px;
      margin: 0 0 7px 0;
      font-size: 1.08em;
      background: #fff;
      border-radius: 7px;
      box-shadow: 0 2px 8px #eee;
      font-weight: bold;
      color: #124;
      border-left: 6px solid #d3e5ff;
      letter-spacing: .5px;
    }
    .stock-list .change-up { color: #27ae60; font-weight: bold;}
    .stock-list .change-down { color: #e74c3c; font-weight: bold;}
    .stock-list .change-neutral { color: #777; }
    @media (max-width: 1100px) {
      .container { flex-direction: column; align-items: stretch; }
      .left, .right, .middle { width: 100%; min-height: unset; }
      .gauge-area { width: 95vw; }
    }
    /* Gauge YARIM DAİRE */
    .gauge {
      position: relative;
      width: 410px;
      height: 210px;
      margin: 0 auto;
      background: #fff;
    }
    .gauge-canvas {
      width: 100%;
      height: 100%;
      display: block;
    }
    .gauge-labels {
      position: absolute; width: 100%; height: 100%; top: 0; left: 0;
      pointer-events: none;
    }
    .gauge-labels span {
      position: absolute;
      font-size: 1em;
      font-weight: 600;
      color: #333;
      width: 82px;
      text-align: center;
      line-height: 1.13em;
    }
    .gauge-labels .l1 { left: 2px; top: 120px;}
    .gauge-labels .l2 { left: 55px; top: 22px;}
    .gauge-labels .l3 { left: 163px; top: -9px;}
    .gauge-labels .l4 { right: 60px; top: 22px;}
    .gauge-labels .l5 { right: 2px; top: 120px;}
    .gauge-score {
      position: absolute; top: 59%; left: 50%; transform: translate(-50%,-50%);
      font-size: 2.4em; font-weight: bold; color: #fff; background: #ff9800;
      border-radius: 32px; padding: 8px 34px; z-index: 22;
      box-shadow: 0 2px 10px #ddd;
      border: 3.5px solid #fff;
      letter-spacing: 2px;
    }
    .gauge-section-label {
      position: absolute; left: 50%; transform: translateX(-50%);
      width: 98%; text-align: center; bottom: -9px;
      font-size: 1em; color: #222;
      font-weight: bold;
      background: none;
    }
  </style>
</head>
<body>
  <header>Trion Strateji</header>
  <div class="center-buttons">
    <button id="bistBtn">Borsa İstanbul</button>
    <button id="usBtn">Amerika B.</button>
    <button id="emtiaBtn">Emtialar</button>
  </div>
  <div class="container">
    <!-- SOLDA TAKİPÇİ LİSTE -->
    <div class="left">
      <ul class="stock-list" id="stock-list"></ul>
    </div>
    <!-- ORTA GRAFİK VE GAUGE -->
    <div class="middle">
      <div id="tv-chart"></div>
      <div class="gauge-area">
        <div class="gauge-label" id="gauge-label">Açgözlülük Endeksi</div>
        <div class="gauge" id="gaugeBox">
          <canvas class="gauge-canvas" id="gauge-canvas" width="410" height="210"></canvas>
          <div class="gauge-labels">
            <span class="l1">Çok<br>Çekingen</span>
            <span class="l2">Çekingen</span>
            <span class="l3">Normal</span>
            <span class="l4">Hırslı</span>
            <span class="l5">Çok<br>Hırslı</span>
          </div>
          <div class="gauge-score" id="gauge-score"></div>
          <div class="gauge-section-label" id="gauge-section-label"></div>
        </div>
      </div>
    </div>
    <!-- SAĞDA HABERLER -->
    <div class="right">
      <div class="news-title">Finans Haberleri</div>
      <div class="news-list" id="news-list"></div>
    </div>
  </div>
  <!-- TradingView JS -->
  <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
  <script>
    // 1. Sol: Liste ve değişim
    const stockLists = {
      bist: [
        { code: "ASELS", change: +2.15 },
        { code: "GARAN", change: -1.13 },
        { code: "THYAO", change: +0.87 },
        { code: "KCHOL", change: +0.05 },
        { code: "ENKAI", change: -0.44 },
        { code: "FROTO", change: +1.33 },
        { code: "BIMAS", change: -2.51 },
        { code: "AKBNK", change: +0.01 },
        { code: "TUPRS", change: 0.00 }
      ],
      nasdaq: [
        { code: "Apple", change: +2.10 },
        { code: "Microsoft", change: -0.31 },
        { code: "Amazon", change: +0.96 },
        { code: "Alphabet", change: -0.82 },
        { code: "Meta", change: +3.21 },
        { code: "Nvidia", change: +4.12 },
        { code: "Tesla", change: -1.18 }
      ],
      emtia: [
        { code: "Gümüş", change: +1.28 },
        { code: "Petrol", change: -0.71 },
        { code: "Platin", change: +0.55 },
        { code: "BTC", change: +2.49 },
        { code: "Ethereum", change: +1.70 },
        { code: "Ripple", change: -0.05 },
        { code: "Amerika 10Y Tahvil", change: -0.11 }
      ]
    };
    function renderStockList(type) {
      let html = "";
      stockLists[type].forEach(s => {
        let cls = s.change > 0 ? 'change-up' : (s.change < 0 ? 'change-down' : 'change-neutral');
        let val = s.change > 0 ? '+' : (s.change < 0 ? '' : '');
        html += `<li>${s.code}<span class="${cls}">${val}${s.change.toFixed(2)}%</span></li>`;
      });
      document.getElementById("stock-list").innerHTML = html;
    }

    // 2. Orta TradingView Grafik
    function loadChart(symbol) {
      document.getElementById("tv-chart").innerHTML = "";
      let chartDiv = document.createElement('div');
      chartDiv.id = "tradingview_chart";
      chartDiv.style.width = "700px";
      chartDiv.style.height = "400px";
      document.getElementById("tv-chart").appendChild(chartDiv);

      new TradingView.widget({
        "container_id": "tradingview_chart",
        "width": 700,
        "height": 400,
        "symbol": symbol,
        "interval": "D",
        "timezone": "Europe/Istanbul",
        "theme": "light",
        "style": "1",
        "locale": "tr",
        "toolbar_bg": "#f1f3f6",
        "hide_top_toolbar": false,
        "hide_legend": false,
        "save_image": false
      });
    }

    // 3. YARIM DAİRE G A U G E (5 bölmeli, iğneli, merkezi top nokta)
    function drawGauge(val = 62) {
      const canvas = document.getElementById("gauge-canvas");
      const ctx = canvas.getContext("2d");
      ctx.clearRect(0,0,410,210);

      // Bölme açıları ve renkler
      const ranges = [
        {from: 0, to: 20, color: "#f39c12"},   // Çok Çekingen (turuncu)
        {from: 20, to: 40, color: "#e67e22"},  // Çekingen (turuncu-kahve)
        {from: 40, to: 60, color: "#ffd800"},  // Normal (sarı)
        {from: 60, to: 80, color: "#27ae60"},  // Hırslı (yeşil)
        {from: 80, to: 100, color: "#e74c3c"}  // Çok Hırslı (kırmızı)
      ];
      let radius = 95, cx = 205, cy = 205, width = 48;
      let start = Math.PI, end = 2*Math.PI;

      ranges.forEach(r => {
        let s = start + Math.PI * (r.from/100);
        let e = start + Math.PI * (r.to/100);
        ctx.beginPath();
        ctx.arc(cx, cy, radius, s, e, false);
        ctx.strokeStyle = r.color;
        ctx.lineWidth = width;
        ctx.shadowBlur = 0;
        ctx.stroke();
      });

      // İğne
      let a = start + Math.PI*(val/100);
      ctx.save();
      ctx.translate(cx, cy);
      ctx.rotate(a - Math.PI/2); // İğne yukarıdan başlasın
      ctx.beginPath();
      ctx.moveTo(0, 16);
      ctx.lineTo(0, -radius+8);
      ctx.lineWidth = 11;
      ctx.strokeStyle = "#222";
      ctx.shadowBlur = 0;
      ctx.lineCap = "round";
      ctx.stroke();
      // Merkez noktası
      ctx.beginPath();
      ctx.arc(0,0,15,0,2*Math.PI);
      ctx.fillStyle="#555";
      ctx.fill();
      ctx.restore();

      // Değer kutusu
      let score = document.getElementById("gauge-score");
      score.innerText = val;

      // Alt etiket
      let sections = ["Çok Çekingen", "Çekingen", "Normal", "Hırslı", "Çok Hırslı"];
      let sectionLabel = "";
      if(val < 20) sectionLabel = sections[0];
      else if(val < 40) sectionLabel = sections[1];
      else if(val < 60) sectionLabel = sections[2];
      else if(val < 80) sectionLabel = sections[3];
      else sectionLabel = sections[4];
      document.getElementById("gauge-section-label").innerText = sectionLabel;
      score.style.background = ranges[Math.floor(val/20)].color;
      score.style.color = (val < 60) ? "#124" : "#fff";
    }

    // 4. KAP HABERLERİ
    async function fetchKapNews() {
      try {
        const response = await fetch('https://api.allorigins.win/get?url=' + encodeURIComponent('https://www.kap.org.tr/tr/rss/son-dakika-bildirimleri'));
        const data = await response.json();
        const parser = new DOMParser();
        const xml = parser.parseFromString(data.contents, "application/xml");
        const items = Array.from(xml.querySelectorAll('item')).slice(0, 12);
        let html = '';
        items.forEach(item => {
          const title = item.querySelector('title').textContent;
          const link = item.querySelector('link').textContent;
          html += `<div><a href="${link}" target="_blank">${title}</a></div>`;
        });
        document.getElementById('news-list').innerHTML = html;
      } catch (e) {
        document.getElementById('news-list').innerHTML = "KAP haberlerine erişilemiyor.";
      }
    }

    // BAŞLANGIÇTA
    renderStockList("bist");
    loadChart("BIST:XU100");
    drawGauge(62);
    fetchKapNews();

    // BUTONLAR
    document.getElementById('bistBtn').onclick = () => {
      renderStockList("bist");
      loadChart("BIST:XU100");
      drawGauge(62);
      document.getElementById("gauge-label").innerText = "Açgözlülük Endeksi";
    };
    document.getElementById('usBtn').onclick = () => {
      renderStockList("nasdaq");
      loadChart("NASDAQ:NDX");
      drawGauge(53);
      document.getElementById("gauge-label").innerText = "Greed Index";
    };
    document.getElementById('emtiaBtn').onclick = () => {
      renderStockList("emtia");
      loadChart("TVC:GOLD"); // ARTIK ALTIN!
      drawGauge(41);
      document.getElementById("gauge-label").innerText = "VIX";
    };
  </script>
</body>
</html>
