<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Trion Strateji</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5776496009950122" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>Trion Strateji</h1>
    <nav class="market-nav">
      <button onclick="switchMarket('BIST')">Borsa İstanbul</button>
      <button onclick="switchMarket('USA')">Amerika B.</button>
      <button onclick="switchMarket('CMD')">Emtialar</button>
    </nav>
  </header>

  <div class="container">
    <!-- Sol Sütun: TradingView Symbol List -->
    <aside class="sidebar">
      <div id="watchlist-container"></div>
    </aside>

    <!-- Orta Bölüm: Chart ve Gauge -->
    <section class="main">
      <div id="tv-chart"></div>
      <!-- Google Charts yerine statik gauge (opsiyonel) -->
      <div id="gauge-text" class="gauge-text">--</div>
      <div id="rss-feed">
        <h3>Finans Haberleri</h3>
        <ul id="news-list"></ul>
      </div>
    </section>

    <!-- Sağ Sütun: Reklam -->
    <aside class="news">
      <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5776496009950122" data-ad-slot="5878236921" data-ad-format="auto" data-full-width-responsive="true"></ins>
      <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script>
    </aside>
  </div>

  <footer>
    <a href="about.html">Hakkında</a> |
    <a href="contact.html">İletişim</a>
  </footer>

  <script>
    const lists = {
      BIST: {
        widget: {
          "symbolsGroups": [{
            "name": "BIST30",
            "symbols": [
              {"name":"AKBNK.IS","display":"AKBNK"}, {"name":"ARCLK.IS","display":"ARCLK"}
              /* ... diğer BIST30 ... */
            ]
          }],
          "showSymbolLogo": true,
          "colorTheme":"light",
          "isTransparent":false,
          "locale":"tr"
        },
        chartSymbol: "BIST:XU100",
        gaugeURL: "/.netlify/functions/get-greed-bist"
      },
      USA: {
        widget: {
          "symbolsGroups": [{
            "name": "NASDAQ Top10",
            "symbols": [
              {"name":"AAPL","display":"AAPL"}, {"name":"MSFT","display":"MSFT"}
              /* ... diğer ... */
            ]
          }],
          "showSymbolLogo": true,
          "colorTheme":"light",
          "isTransparent":false,
          "locale":"en"
        },
        chartSymbol: "NASDAQ:NDX",
        gaugeURL: "/.netlify/functions/get-greed-usa"
      },
      CMD: {
        widget: {
          "symbolsGroups": [{
            "name": "Emtialar",
            "symbols": [
              {"name":"OANDA:XAUUSD","display":"Altın"}, {"name":"OANDA:XAGUSD","display":"Gümüş"}, {"name":"COINBASE:BTCUSD","display":"BTC"}
            ]
          }],
          "showSymbolLogo": true,
          "colorTheme":"light",
          "isTransparent":false,
          "locale":"en"
        },
        chartSymbol: "OANDA:XAUUSD",
        gaugeURL: "/.netlify/functions/get-greed-cmd"
      }
    };

    function loadWatchlist(market) {
      const container = document.getElementById('watchlist-container');
      container.innerHTML = '<div class="tradingview-widget-container"><div id="symbol-list"></div></div>';
      new TradingView.widget({
        "width": "100%",
        "height": 600,
        "symbol": "",
        "interval": "D",
        "timezone": "Etc/UTC",
        "theme": "light",
        "style": "1",
        "locale": lists[market].widget.locale,
        "toolbar_bg": "#f1f3f6",
        "enable_publishing": false,
        "hide_side_toolbar": false,
        "allow_symbol_change": true,
        "details": true,
        "studies": [],
        "container_id": "symbol-list",
        ...lists[market].widget
      });
    }

    function loadChart(market) {
      const container = document.getElementById('tv-chart'); container.innerHTML = '';
      new TradingView.widget({
        "width": "100%",
        "height": "60vh",
        "symbol": lists[market].chartSymbol,
        "interval": "D",
        "timezone": "Europe/Istanbul",
        "theme": "light",
        "style": "1",
        "locale": "tr",
        "toolbar_bg": "#f1f3f6",
        "container_id": "tv-chart"
      });
    }

    function loadGauge(market) {
      fetch(lists[market].gaugeURL)
        .then(res => res.json())
        .then(d => document.getElementById('gauge-text').textContent = Math.round(d.value))
        .catch(() => document.getElementById('gauge-text').textContent = '0');
    }

    // RSS
    (function(){
      const ul = document.getElementById('news-list');
      fetch('https://api.rss2json.com/v1/api.json?rss_url='+encodeURIComponent('https://rss.investing.com/top-news.rss'))
        .then(r=>r.json()).then(d=>{
          ul.innerHTML = '';
          d.items.slice(0,5).forEach(i=>{
            const li = document.createElement('li');
            li.innerHTML = `<a href="${i.link}" target="_blank">${i.title}</a>`;
            ul.appendChild(li);
          });
        });
    })();

    function switchMarket(m) {
      loadWatchlist(m);
      loadChart(m);
      loadGauge(m);
    }

    // load TradingView script
    const tvScript = document.createElement('script');
    tvScript.src = 'https://s3.tradingview.com/tv.js';
    tvScript.onload = () => switchMarket('BIST');
    document.head.appendChild(tvScript);
  </script>
</body>
</html>
